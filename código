#include <stdio.h>
#include <stdlib.h>
#include<string.h>

void imprimirParametros();
void imprimirInfo();

struct ficha{
    char nombre[100];
    char contrasennya[100];
    int registro;
    
};

struct registro{
    float ph;
    float conductividad;
    float turbidez;
    int coliformes;
    char distrito [100];
    float temperatura;
};

int main(){
    
    struct ficha usuarios[500];
    struct registro parametros [500];
    int inicio,numeroUsuarios=0,numParametros=0;
       int numeracion=0, i=0, j=0, a, b, n=0;
       int opcion;
       FILE * fichero;
       FILE * datos;
    
    fichero=fopen("usuarios.txt","r");
    if(fichero==NULL){ //comprobamos que el fichero con el que vamos a trabajar funciona
        printf("Error en la apertura de ficheros.\n");
        return 0;
    }
    
    //Vamos a ir guardando los usuarios que se vayan registrando en el fichero
    
    while(fscanf(fichero,"%d %s %s", &usuarios[i].registro,usuarios[i].nombre,usuarios[i].contrasennya)!=EOF){
        numeroUsuarios++;
        i++;
    }
    fclose(fichero);
    while (1) {
        printf("1.Registrarse\n2.Iniciar sesion\n");
        scanf("%d",&inicio);
        fflush(stdin);
        switch(inicio){
            
            //Vamos a introducir un nuevo usuario:
            case 1:
                
                usuarios[i].registro=i+1;
                
                //pedimos nombre y contrasennya
                
                printf("Introduzca su nombre de usuario o salir si quiere salir:\t");
                fflush(stdin);
                gets(usuarios[i].nombre);
                if(strcmp(usuarios[i].nombre,"salir") == 0){
                    continue;
                }
                printf("Introduzca su contrasenya:\t");
                fflush(stdin);
                gets(usuarios[i].contrasennya);
                        
                        
                //vamos a comprobar que no coincida con el nombre de ninguno de los usuarios previamente registrados. En caso de que no coincida, este se annyadira al fichero y se quedar registrada la posicion en la que se annyadio de forma que el siguiente usuario en registrarse quedara annydido a continuacion.
                
                for(a=0;a<numeroUsuarios;a++){ //el numero de usuarios ira incrementando segun incremente el numero de registros, de forma que cada vez que haya un nuevo resgistro se compare con los ya existentes usuarios
                    
                    for(j=0;j<i;j++){ //en este caso estaremos comparando el nuevo usuario con los ya existentes
                        if(strcmp(usuarios[i].nombre,usuarios[j].nombre)==0){
                            printf("El nombre de usuario escogido ya existe. Por favor elija otro:\t");
                            fflush(stdin);
                            gets(usuarios[i].nombre);
                        }
                    }
                }
                
                fichero=fopen("usuarios.txt","w");
                if(fichero==NULL){ //comprobamos que el fichero que estamos abriendo funciona
                    printf("Error\n");
                    return 0;
                }
                for(n=0;n<=i;n++){
                    fprintf(fichero,"%d %s %s\n", usuarios[n].registro,usuarios[n].nombre,usuarios[n].contrasennya);
                }
                fclose(fichero);

                b=i;
                   
                break;
            
            //usuario ya registrado inicia sesión
            case 2:
           
               do{ //pedimos el nombre y la contrasennya y comprobamos que ambos coincidan con un usuario ya registrado anteriormente (este estara guardado en el fichero)
                   printf("Nombre de usuario:\t");
                   fflush(stdin);
                   gets(usuarios[i].nombre);
                   printf("Contrasennya:\t");
                   fflush(stdin);
                   gets(usuarios[i].contrasennya);
                   
                   for(b=0;b<numeroUsuarios;b++){
                       if((strcmp(usuarios[i].nombre,usuarios[b].nombre)==0)&&(strcmp(usuarios[i].contrasennya,usuarios[b].contrasennya)==0)){
                           numeracion++;
                           break;
                       }
                   }
                   if(numeracion==0){ //en caso de que no coincida con un usuario registrado no le dejara continuar
                       printf("El nombre de usuario o la contrasennya introducidos ha sido incorrecto, por favor introduzcalos de nuevo.\n");
                   }
                }while(numeracion==0);
                break;
        }
    
    
    do{
        printf("1-Consultar datos\n2-Introducir nuevos datos\n3-Acerca de los parametros\n4-Acerca de la aplicación\n5-Salir\n");
        scanf("%d",&opcion);
        if(opcion==1){
            //abrir el fichero con datos previamente introducidos
            
            datos=fopen("parametros.txt","r");
            if(datos==NULL){ //comprobamos que el fichero con el que vamos a trabajar funciona
                printf("Error en la apertura de ficheros.\n");
                return 0;
            }
            i=0;
            while(fscanf(datos,"%s %f %f %f %d %f", parametros[i].distrito,&parametros[i].ph,&parametros[i].conductividad,&parametros[i].turbidez,&parametros[i].coliformes,&parametros[i].temperatura)!=EOF){
                numParametros++;
                i++;
            }
            fclose(datos);
           
            // imprimir el fichero con los datos
            for (i = 0; i < numParametros; i++) {
                printf("Distrito: %s\n", parametros[i].distrito);
                printf("pH: %.2f\n", parametros[i].ph);
                printf("Conductividad: %.2f\n", parametros[i].conductividad);
                printf("Turbidez: %.2f\n", parametros[i].turbidez);
                printf("Coliformes: %d\n", parametros[i].coliformes);
                printf("Temperatura: %.2f\n", parametros[i].temperatura);
                printf("\n");
            }
            
        }else if(opcion==2){
            //meter función para introducir nuevos datos
            datos=fopen("parametros.txt","a");
            if(datos==NULL){ //comprobamos que el fichero con el que vamos a trabajar funciona
                printf("Error en la apertura de ficheros.\n");
                return 0;
            }
            i=0;
            printf("Distrito:\t");
            fflush(stdin);
            gets(parametros[i].distrito);
            printf("pH:\t");
            fflush(stdin);
            scanf("%f", &parametros[i].ph);
            printf("Conductividad:\t");
            fflush(stdin);
            scanf("%f", &parametros[i].conductividad);
            printf("Turbidez:\t");
            fflush(stdin);
            scanf("%f", &parametros[i].turbidez);
            printf("Coliformes:\t");
            fflush(stdin);
            scanf("%d", &parametros[i].coliformes);
            printf("Temperatura:\t");
            fflush(stdin);
            scanf("%f", &parametros[i].temperatura);
            
            fprintf(datos,"%s\t", parametros[i].distrito);
            fprintf(datos,"%.2f\t", parametros[i].ph);
            fprintf(datos,"%.2f\t", parametros[i].conductividad);
            fprintf(datos,"%.2f\t", parametros[i].turbidez);
            fprintf(datos,"%d\t", parametros[i].coliformes);
            fprintf(datos,"%.2f\n", parametros[i].temperatura);
            
        
        }else if(opcion==3){
            imprimirParametros();
            //meter todo el printf de los parametros en la funcion que hay abajo
            
            datos=fopen("parametros.txt","r");
            if(datos==NULL){ //comprobamos que el fichero con el que vamos a trabajar funciona
                printf("Error en la apertura de ficheros.\n");
                return 0;
            }
            i=0;
            while(fscanf(datos,"%s %f %f %f %d %f", parametros[i].distrito,&parametros[i].ph,&parametros[i].conductividad,&parametros[i].turbidez,&parametros[i].coliformes,&parametros[i].temperatura)!=EOF){
                numParametros++;
                i++;
            }
            fclose(datos);
            
           float phTotal=0, conducTotal=0, turbTotal=0, tempTotal=0;
            float phTot[numParametros],condTot[numParametros],turbTot[numParametros],tempTot[numParametros];
           
            // imprimir el fichero con los datos
            for (i = 0; i < numParametros; i++) {
                phTot[i]=parametros[i].ph;
                condTot[i]=parametros[i].conductividad;
                turbTot[i]=parametros[i].turbidez;
                tempTot[i]=parametros[i].temperatura;
                
            }
            for(i=0;i < numParametros; i++){
                phTotal+=phTot[i];
                conducTotal+=condTot[i];
                turbTotal+=turbTot[i];
                tempTotal+=tempTot[i];
            }
            
            printf("pH medio = %.2f\n", phTotal/numParametros);
            printf("Conductividad media = %.2f\n", conducTotal/numParametros);
            printf("Turbidez media = %.2f\n", turbTotal/numParametros);
            printf("Temperatura media = %.2f\n", tempTotal/numParametros);
            printf("\n");

            
        }else if(opcion==4){
            imprimirInfo();
        }
    }while(opcion==5);
    }
}

//FUNCIONES
void imprimirParametros(){}
void imprimirInfo(){
    printf("CLEAN WATER\n\n¡Bienvenidos a CleanWater!\n Somos una página web dedicada a recopilar datos sobre la calidad del agua en los distintos distritos de Madrid. Nuestra misión es proporcionar información precisa y actualizada sobre el estado del agua en cada área, para que los ciudadanos puedan tomar decisiones informadas sobre su consumo y uso.\nEn CleanWater, recopilamos datos de diversas fuentes confiables y los presentamos de manera clara y accesible. Nuestro objetivo es proporcionar información detallada sobre la calidad del agua, incluyendo niveles de pH, cloro, turbidez, y otros parámetros importantes. También ofrecemos consejos y recomendaciones para garantizar que el agua que se consume en casa sea segura y saludable.\nNuestra página web es fácil de usar y está diseñada para ser accesible a todos. Queremos que la información sobre la calidad del agua sea accesible a todos los ciudadanos de Madrid, para que puedan tomar decisiones informadas sobre su consumo de agua.\nEn CleanWater, creemos que el acceso a información precisa y actualizada sobre la calidad del agua es fundamental para garantizar la salud y el bienestar de las personas. Esperamos que nuestra página web sea una herramienta útil para todos los ciudadanos de Madrid y contribuya a mejorar la calidad del agua en toda la ciudad.");
}


